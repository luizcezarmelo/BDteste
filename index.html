<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda do Fofo</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #fff;
      color: #000;
    }
    .container {
      display: flex;
      flex-direction: column;
    }
    @media (min-width: 768px) {
      .container {
        flex-direction: row;
        min-height: 100vh;
      }
    }
    .left-panel, .right-panel { padding: 20px; }
    .left-panel { flex: 2; border-right: 1px solid #ccc; }
    .right-panel { flex: 1; }

    .calendar-section {
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .calendar-section button { padding: 5px 10px; cursor: pointer; }

    .day-nav {
      display: flex;
      gap: 8px;
      align-items: center;
      margin: -10px 0 10px 0;
    }
    .day-nav button { padding: 2px 8px; cursor: pointer; }

    .actions { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
    .search-area { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; }
    .search-area input { flex: 1; padding: 5px; min-width: 120px; }
    .search-results { background: #fff; border: 1px solid #ccc; padding: 10px; max-height: 150px; overflow-y: auto; }
    .search-results div { cursor: pointer; padding: 4px; }
    .search-results div:hover { background: #eee; }

    .commitment {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      flex-wrap: wrap;
      padding: 5px;
      border-radius: 4px;
    }
    .commitment input[type="time"] { margin-right: 5px; }
    .commitment input[type="text"] { flex: 1; padding: 5px; margin-right: 5px; }
    .commitment button { margin-left: 3px; }

    .done { text-decoration: line-through; color: gray; }
    .checked { background-color: #d1e7ff; }
    .destaque { background: yellow; }

    #cpfStatus.valid { color: blue; }
    #cpfStatus.invalid { color: red; }
  </style>
</head>
<body>
  <div class="container" id="main-content">
    <div class="left-panel">
      <h1>Agenda do Fofo</h1>
      <div class="calendar-section">
        <input type="date" id="dataSelecionada">
        <button id="hojeBtn" title="Hoje">üìÖ</button>
      </div>
      <div class="day-nav">
        <button id="prevDayBtn">‚óÄ</button>
        <button id="nextDayBtn">‚ñ∂</button>
      </div>
      <div class="actions">
        <button id="novoBtn">Novo</button>
        <button id="exportarBtn">Exportar TXT</button>
      </div>
      <div id="agenda"></div>
    </div>

    <div class="right-panel">
      <h2>Validador de CPF</h2>
      <div style="display:flex; gap:5px;">
        <input type="text" id="cpf" placeholder="Digite o CPF">
        <button onclick="limparCPF()">‚ùå</button>
      </div>
      <p id="cpfStatus"></p>
      <button onclick="copiarCPF()">Copiar</button>

      <h3>üîç Pesquisa</h3>
      <div class="search-area">
        <input type="text" id="search" placeholder="Pesquisar...">
        <button onclick="limparBusca()">‚ùå</button>
      </div>
      <div id="searchResults" class="search-results"></div>

      <h3>üìù Lembretes Fixos</h3>
      <textarea id="notasFixas" rows="12" style="width:100%;"></textarea>
    </div>
  </div>

<script>
  // --- VARI√ÅVEIS GLOBAIS ---
  const agendaEl = document.getElementById('agenda');
  const dataInput = document.getElementById('dataSelecionada');
  const novoBtn = document.getElementById('novoBtn');
  const exportarBtn = document.getElementById('exportarBtn');
  const hojeBtn = document.getElementById('hojeBtn');
  const prevDayBtn = document.getElementById('prevDayBtn');
  const nextDayBtn = document.getElementById('nextDayBtn');
  const notasFixasEl = document.getElementById('notasFixas');
  const searchEl = document.getElementById('search');
  const searchResultsEl = document.getElementById('searchResults');

  const maxCompromissos = 20;
  let compromissosDia = [];

  // --- FUN√á√ïES AGENDA ---
  function carregarAgenda() {
    agendaEl.innerHTML = '';
    compromissosDia = JSON.parse(localStorage.getItem(dataInput.value)) || [];
    while (compromissosDia.length < 15) compromissosDia.push({hora:'', texto:'', feito:false});

    compromissosDia.forEach((c, i) => agendaEl.appendChild(criarCampoCompromisso(c, i)));
  }

  function salvarAgenda() {
    localStorage.setItem(dataInput.value, JSON.stringify(compromissosDia));
  }

  function criarCampoCompromisso(item, idx) {
    const div = document.createElement('div');
    div.className = 'commitment';
    if (item.feito) div.classList.add('done');

    const hora = document.createElement('input');
    hora.type = 'time';
    hora.value = item.hora;
    hora.onchange = () => { compromissosDia[idx].hora = hora.value; salvarAgenda(); };

    const input = document.createElement('input');
    input.type = 'text';
    input.value = item.texto;
    input.oninput = () => { compromissosDia[idx].texto = input.value; salvarAgenda(); };

    const okBtn = document.createElement('button');
    okBtn.textContent = '‚úî';
    okBtn.onclick = () => { 
      input.classList.toggle('done');
      compromissosDia[idx].feito = !compromissosDia[idx].feito;
      salvarAgenda();
    };

    const delBtn = document.createElement('button');
    delBtn.textContent = 'üóë';
    delBtn.onclick = () => { 
      compromissosDia.splice(idx,1);
      salvarAgenda(); carregarAgenda();
    };

    div.append(hora,input,okBtn,delBtn);
    return div;
  }

  function adicionarCompromisso() {
    if (compromissosDia.length < maxCompromissos) {
      compromissosDia.push({hora:'', texto:'', feito:false});
      salvarAgenda(); carregarAgenda();
    }
  }

  function exportarParaTXT() {
    let conteudo = `Agenda do dia ${dataInput.value}\n\n`;
    compromissosDia.forEach((c,i)=> {
      if (c.texto) conteudo += `${i+1}. ${c.hora?c.hora+' - ':''}${c.texto}${c.feito?' (‚úî conclu√≠do)':''}\n`;
    });
    const blob = new Blob([conteudo], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `agenda_${dataInput.value}.txt`;
    a.click();
  }

  // --- PESQUISA ---
  function pesquisarCompromisso() {
    searchResultsEl.innerHTML = '';
    const termo = searchEl.value.trim().toUpperCase();
    if (termo.length < 3) return;
    for (let key in localStorage) {
      if (!key.match(/^\d{4}-\d{2}-\d{2}$/)) continue;
      let dados = JSON.parse(localStorage.getItem(key)) || [];
      dados.forEach((c,i)=> {
        if (c.texto && c.texto.includes(termo)) {
          const div = document.createElement('div');
          div.textContent = `${key}: ${c.hora} - ${c.texto}`;
          div.onclick = ()=> {
            dataInput.value = key;
            carregarAgenda();
          };
          searchResultsEl.appendChild(div);
        }
      });
    }
  }
  function limparBusca() { searchEl.value=''; searchResultsEl.innerHTML=''; }

  // --- CPF ---
  function validarCPF(cpf) {
    cpf = cpf.replace(/\D/g,'');
    if (cpf.length!==11 || /^(\d)\1{10}$/.test(cpf)) return false;
    let soma=0, resto;
    for(let i=1;i<=9;i++) soma+=parseInt(cpf[i-1])*(11-i);
    resto=(soma*10)%11; if(resto===10||resto===11) resto=0;
    if(resto!==parseInt(cpf[9])) return false;
    soma=0;
    for(let i=1;i<=10;i++) soma+=parseInt(cpf[i-1])*(12-i);
    resto=(soma*10)%11; if(resto===10||resto===11) resto=0;
    return resto===parseInt(cpf[10]);
  }
  document.getElementById('cpf').addEventListener('input', e=>{
    const raw = e.target.value.replace(/\D/g,'');
    const status = document.getElementById('cpfStatus');
    if (validarCPF(raw)) { status.textContent='CPF v√°lido'; status.className='valid'; }
    else { status.textContent='CPF inv√°lido'; status.className='invalid'; }
  });
  function copiarCPF() {
    let raw=document.getElementById('cpf').value.replace(/\D/g,'');
    if (validarCPF(raw)) {
      let f=raw.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4");
      navigator.clipboard.writeText(f);
    }
  }
  function limparCPF() { document.getElementById('cpf').value=''; document.getElementById('cpfStatus').textContent=''; }

  // --- LEMBRETES COM POPUP ---
  function verificarLembretes() {
    const agora = new Date();
    const dataHoje = agora.toISOString().split('T')[0];
    const dadosHoje = JSON.parse(localStorage.getItem(dataHoje)) || [];
    dadosHoje.forEach(c=>{
      if (c.hora && c.texto && !c.avisoMostrado) {
        const [h,m] = c.hora.split(':');
        if (agora.getHours()==h && agora.getMinutes()==m) {
          mostrarNotificacao(`Lembrete: ${c.texto}`);
          c.avisoMostrado=true;
          localStorage.setItem(dataHoje, JSON.stringify(dadosHoje));
        }
      }
    });
  }
  function mostrarNotificacao(msg) {
    if ("Notification" in window) {
      if (Notification.permission==="granted") new Notification("Agenda do Fofo",{body:msg});
      else if (Notification.permission!=="denied") {
        Notification.requestPermission().then(p=>{ if(p==="granted") new Notification("Agenda do Fofo",{body:msg}); else alert(msg); });
      } else alert(msg);
    } else alert(msg);
  }

  // --- INICIALIZA√á√ÉO ---
  dataInput.value = new Date().toISOString().split('T')[0];
  carregarAgenda();

  novoBtn.onclick=adicionarCompromisso;
  exportarBtn.onclick=exportarParaTXT;
  hojeBtn.onclick=()=>{ dataInput.value=new Date().toISOString().split('T')[0]; carregarAgenda(); };
  prevDayBtn.onclick=()=>{ let d=new Date(dataInput.value); d.setDate(d.getDate()-1); dataInput.value=d.toISOString().split('T')[0]; carregarAgenda(); };
  nextDayBtn.onclick=()=>{ let d=new Date(dataInput.value); d.setDate(d.getDate()+1); dataInput.value=d.toISOString().split('T')[0]; carregarAgenda(); };
  searchEl.oninput=pesquisarCompromisso;

  notasFixasEl.value=localStorage.getItem('notasFixas')||'';
  notasFixasEl.oninput=()=>localStorage.setItem('notasFixas', notasFixasEl.value);

  setInterval(verificarLembretes,60000); // verifica lembretes a cada minuto
</script>
</body>
</html>
