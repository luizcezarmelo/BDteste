<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agenda do Fofo</title>
  <style>
    * { box-sizing: border-box; }
    :root{
      --b: #0f172a;      /* slate-900 */
      --fg:#0b1324;      /* text */
      --muted:#6b7280;   /* gray-500 */
      --bd:#e5e7eb;      /* gray-200 */
      --pri:#2563eb;     /* blue-600 */
      --pri-2:#1e40af;   /* blue-800 */
      --ok:#16a34a;      /* green-600 */
      --warn:#ea580c;    /* orange-600 */
      --bg:#ffffff;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue','Noto Sans',Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{display:flex;flex-direction:column}
    @media(min-width:900px){.container{flex-direction:row;min-height:100vh}}
    .left-panel,.right-panel{padding:20px}
    .left-panel{flex:2;border-right:1px solid var(--bd)}
    .right-panel{flex:1}
    h1{margin:0 0 10px 0}
    .calendar-section{margin:12px 0;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .day-nav{display:flex;gap:8px;align-items:center;margin:0 0 12px 0}
    button{cursor:pointer;border:1px solid var(--bd);background:#f8fafc;border-radius:8px;padding:8px 12px}
    button:hover{background:#eef2ff}
    .actions{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap}
    .search-area{display:flex;gap:6px;align-items:center;margin:8px 0;flex-wrap:wrap}
    .search-area input{flex:1;min-width:160px;padding:8px;border:1px solid var(--bd);border-radius:6px}
    .search-results{border:1px solid var(--bd);border-radius:8px;max-height:220px;overflow:auto}
    .search-results div{padding:8px 10px;border-bottom:1px solid var(--bd);cursor:pointer}
    .search-results div:last-child{border-bottom:none}
    .search-results div:hover{background:#f1f5f9}
    .commitment{display:grid;grid-template-columns:92px 1fr auto auto;gap:6px;align-items:center;padding:8px;border:1px solid var(--bd);border-radius:10px;margin-bottom:8px}
    .commitment input[type="time"]{padding:6px;border:1px solid var(--bd);border-radius:6px;width:100%}
    .commitment input[type="text"]{padding:8px;border:1px solid var(--bd);border-radius:6px;width:100%}
    .commitment .ok{border-color:#c7f0cf;background:#ecfdf5}
    .commitment .del{border-color:#ffd7d7;background:#fff1f2}
    .done{text-decoration:line-through;color:#6b7280}
    .checked{background:#e7f0ff}
    .destaque{outline:3px solid #fde68a;background:#fffbeb}
    .muted{color:var(--muted);font-size:.9rem}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .tag{display:inline-flex;align-items:center;gap:6px;background:#eef2ff;border:1px solid var(--bd);border-radius:999px;padding:6px 10px;font-size:.85rem}
    .pill{background:#ecfeff;border:1px solid #bae6fd;border-radius:999px;padding:2px 8px;font-size:.75rem}
    .panel{border:1px solid var(--bd);border-radius:12px;padding:12px}
    /* LOGIN */
    #login-screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#f3f4f6;z-index:1000}
    #login-card{background:#fff;border:1px solid var(--bd);border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.08);min-width:320px;max-width:92vw}
    #login-card h2{margin:0 0 10px 0}
    #login-card input{width:100%;padding:10px;border:1px solid var(--bd);border-radius:8px}
    #login-card .msg{min-height:18px;font-size:.9rem}
    #toggle-pass{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:none;font-size:1rem;cursor:pointer}
    .relogio{font-variant-numeric:tabular-nums}
  </style>
</head>
<body>
  <!-- LOGIN -->
  <div id="login-screen">
    <div id="login-card">
      <h2 id="login-title">Acesso Restrito</h2>
      <p class="muted" id="login-sub">Entre com a senha para continuar.</p>
      <div style="position:relative;margin:8px 0 6px 0">
        <input type="password" id="password-input" placeholder="Digite a senha" />
        <button id="toggle-pass" title="Mostrar/ocultar">üëÅÔ∏è</button>
      </div>
      <div class="row">
        <button id="login-btn">Entrar</button>
        <button id="define-btn" style="display:none">Definir senha</button>
      </div>
      <div class="msg" id="login-error" style="color:#dc2626;"></div>
      <div class="muted" style="margin-top:8px">Dica: Enter confirma.</div>
    </div>
  </div>

  <!-- APP -->
  <div class="container" id="app" style="display:none">
    <!-- (Restante do HTML igual ao original) -->
  </div>

  <!-- Firebase + App (ESM) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getDatabase, ref, child, get, set
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBiikcagIm1p7wJG6DsHijkvdy1fpDBn8Y",
      authDomain: "bd-teste-c931c.firebaseapp.com",
      databaseURL: "https://bd-teste-c931c-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "bd-teste-c931c",
      storageBucket: "bd-teste-c931c.firebasestorage.app",
      messagingSenderId: "270308100761",
      appId: "1:270308100761:web:ae34fde6d5ae86b67b0608"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // (... c√≥digo de login, agenda, etc. permanece igual ...)

    /************* Alarmes *************/
    function notificar(msg){
      alert(msg); // ‚úÖ Agora o alarme abre popup
    }

    async function checarAlarmes(){
      const hoje = hojeISO();
      const now = new Date();
      if (ui.dataInput.value !== hoje) {
        const snap = await get(child(ref(db), `agenda/${hoje}`));
        if (!snap.exists()) return;
        const lista = snap.val() || [];
        let houveAlteracao = false;
        for (let i=0;i<lista.length;i++){
          const c = lista[i];
          if (!c || !c.hora || !c.texto) continue;
          const [h,m] = (c.hora||'').split(':').map(x=>parseInt(x,10));
          if (Number.isNaN(h) || Number.isNaN(m)) continue;
          const comp = new Date();
          comp.setHours(h,m,0,0);
          const jaAvisado = !!c.avisadoEm;
          if (!jaAvisado && comp.getTime() <= now.getTime()) {
            notificar(`Lembrete (${c.hora}): ${c.texto}`);
            c.avisadoEm = Date.now();
            lista[i] = c;
            houveAlteracao = true;
          }
        }
        if (houveAlteracao) await set(ref(db, `agenda/${hoje}`), lista);
        return;
      }

      let mudou = false;
      for (let i=0;i<dadosDia.length;i++){
        const c = dadosDia[i];
        if (!c || !c.hora || !c.texto) continue;
        const [h,m] = c.hora.split(':').map(x=>parseInt(x,10));
        if (Number.isNaN(h) || Number.isNaN(m)) continue;
        const comp = new Date();
        comp.setHours(h,m,0,0);
        const jaAvisado = !!c.avisadoEm;
        if (!jaAvisado && comp.getTime() <= Date.now()) {
          notificar(`Lembrete (${c.hora}): ${c.texto}`);
          c.avisadoEm = Date.now();
          mudou = true;
        }
      }
      if (mudou) salvarAgenda(true);
    }

    setInterval(checarAlarmes, 30000);
  </script>
</body>
</html>
