<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda do Fofo</title>
  <style>
    /* CSS existente mantido */
    * { box-sizing: border-box; }
    body { margin: 0; font-family: Arial, sans-serif; background-color: #fff; color: #000; }
    .container { display: flex; flex-direction: column; }
    @media (min-width: 768px) { .container { flex-direction: row; min-height: 100vh; } }
    .left-panel, .right-panel { padding: 20px; }
    .left-panel { flex: 2; border-right: 1px solid #ccc; }
    .right-panel { flex: 1; }
    .commitment { display: flex; align-items: center; margin-bottom: 5px; flex-wrap: wrap; padding: 5px; }
    .commitment input[type="text"] { flex: 1; padding: 5px; margin-right: 5px; min-width: 120px; }
    .commitment button { margin-left: 3px; }
    .alarm-btn { font-size: 18px; cursor: pointer; background: none; border: none; }
    .alarm-red { color: red; }
    .alarm-green { color: green; }
    /* Modal para escolher hora */
    #alarmModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    #alarmModal .modal-content { background: #fff; padding: 20px; border-radius: 8px; text-align: center; }
  </style>
</head>
<body>
  <div class="container" id="main-content">
    <div class="left-panel">
      <h1>Agenda do Fofo</h1>
      <div class="calendar-section">
        <input type="date" id="dataSelecionada">
      </div>
      <div id="agenda"></div>
    </div>
  </div>

  <!-- Modal para escolher hora -->
  <div id="alarmModal">
    <div class="modal-content">
      <h3>Definir Alarme</h3>
      <input type="time" id="alarmTime">
      <br><br>
      <button id="setAlarmBtn">OK</button>
    </div>
  </div>

<script>
  const agendaEl = document.getElementById('agenda');
  const alarmModal = document.getElementById('alarmModal');
  const alarmTimeInput = document.getElementById('alarmTime');
  const setAlarmBtn = document.getElementById('setAlarmBtn');
  let currentAlarmBtn = null;

  // Lista de alarmes ativos: {time: 'HH:MM', texto: 'compromisso', btn: elemento}
  let alarms = [];

  document.getElementById('dataSelecionada').value = new Date().toISOString().split('T')[0];

  // Criar compromissos de exemplo
  for (let i = 0; i < 3; i++) {
    agendaEl.appendChild(criarCampoCompromisso({texto: 'Compromisso ' + (i+1)}));
  }

  function criarCampoCompromisso(item = {texto: ''}) {
    const div = document.createElement('div');
    div.className = 'commitment';

    const input = document.createElement('input');
    input.type = 'text';
    input.value = item.texto;

    const okBtn = document.createElement('button');
    okBtn.textContent = 'OK';

    const alarmBtn = document.createElement('button');
    alarmBtn.innerHTML = '⏰';
    alarmBtn.className = 'alarm-btn alarm-red';
    alarmBtn.onclick = () => {
      currentAlarmBtn = {btn: alarmBtn, input: input};
      alarmModal.style.display = 'flex';
    };

    const delBtn = document.createElement('button');
    delBtn.textContent = 'Excluir';
    delBtn.onclick = () => { input.value = ''; };

    div.appendChild(input);
    div.appendChild(okBtn);
    div.appendChild(alarmBtn);
    div.appendChild(delBtn);

    return div;
  }

  // Configurar alarme no modal
  setAlarmBtn.onclick = () => {
    const time = alarmTimeInput.value;
    if (time && currentAlarmBtn) {
      // salvar alarme
      alarms.push({time: time, texto: currentAlarmBtn.input.value, btn: currentAlarmBtn.btn});
      currentAlarmBtn.btn.classList.remove('alarm-red');
      currentAlarmBtn.btn.classList.add('alarm-green');
      alarmModal.style.display = 'none';
    }
  };

  // Fechar modal clicando fora
  alarmModal.onclick = (e) => { if (e.target === alarmModal) alarmModal.style.display = 'none'; };

  // Verificação dos alarmes a cada minuto
  setInterval(() => {
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,'0');
    const mm = String(now.getMinutes()).padStart(2,'0');
    const currentTime = `${hh}:${mm}`;

    alarms.forEach((alarm, idx) => {
      if (alarm.time === currentTime) {
        alert("Lembrete: " + alarm.texto);
        alarm.btn.classList.remove('alarm-green');
        alarm.btn.classList.add('alarm-red');
        alarms.splice(idx,1);
      }
    });
  }, 1000 * 30); // checa a cada 30 segundos
</script>
</body>
</html>
